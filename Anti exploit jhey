-- ================================================
-- ANTI-EXPLOIT GUI â€” LocalScript v10 FINAL
-- ColÃ³calo en: StarterGui (LocalScript)
-- ================================================

local Players           = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService      = game:GetService("TweenService")
local SoundService      = game:GetService("SoundService")

local player    = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui", 10)
if not playerGui then return end

local remotes = ReplicatedStorage:WaitForChild("AdminRemotes", 15)
if not remotes then return end
local showExploitGui  = remotes:WaitForChild("ShowExploitGui",  10)
local exploitResponse = remotes:WaitForChild("ExploitResponse", 10)
if not showExploitGui or not exploitResponse then return end

-- ================================================
-- UTILIDADES BASE
-- ================================================

local function makeGui()
	local old = playerGui:FindFirstChild("AntiExploitScreen")
	if old then old:Destroy() end
	local gui = Instance.new("ScreenGui")
	gui.Name           = "AntiExploitScreen"
	gui.ResetOnSpawn   = false
	gui.DisplayOrder   = 999
	gui.IgnoreGuiInset = true
	gui.Parent         = playerGui
	return gui
end

local function playSound(id, vol, speed, duration)
	pcall(function()
		local s = Instance.new("Sound")
		s.SoundId       = "rbxassetid://"..id
		s.Volume        = vol or 1
		s.PlaybackSpeed = speed or 1
		s.Parent        = SoundService
		s:Play()
		game:GetService("Debris"):AddItem(s, duration or 10)
	end)
end

local function playScarySound()   playSound("9120932311", 1,   1,   10) end
local function playCreepyVoice()  playSound("1369158958", 1,   0.7, 8)  end

-- FIX: sonido de latido para cada letra de la pregunta
local function playHeartbeat()    playSound("265685563",  0.6, 1.4, 1)  end

-- FIX: latido rÃ¡pido para el contador (mÃ¡s agudo y urgente)
local function playUrgentBeat()   playSound("265685563",  0.9, 2.0, 1)  end

-- FIX: sonido de screamer para el timeout
local function playScreamer()     playSound("9120932311", 1,   1.8, 5)  end

local function fadeIn(elem, prop, dur)
	TweenService:Create(elem, TweenInfo.new(dur), {[prop] = 0}):Play()
end

-- â”€â”€ GLITCH TEXT â”€â”€
-- FIX: solo ASCII para evitar cortes en UTF-8 multi-byte con Lua #string
local GLITCH_CHARS = "#@$%&!?/\\|*^~+-=<>[]{}0123456789"
local function glitchText(label, finalText, duration)
	local steps    = 14
	local stepTime = duration / steps
	for i = 1, steps do
		task.wait(stepTime)
		if not label or not label.Parent then return end
		local glitched = ""
		for j = 1, #finalText do
			if math.random() < (i / steps) then
				glitched = glitched .. finalText:sub(j, j)
			else
				local r = math.random(1, #GLITCH_CHARS)
				glitched = glitched .. GLITCH_CHARS:sub(r, r)
			end
		end
		label.Text = glitched
	end
	if label and label.Parent then label.Text = finalText end
end

-- â”€â”€ PARPADEO OSCURO â†’ BLANCO â”€â”€
local function flickerDark(frame, times, callback)
	task.spawn(function()
		for _ = 1, times do
			task.wait(0.05)
			if not frame or not frame.Parent then break end
			frame.BackgroundColor3 = Color3.fromRGB(20, 0, 0)
			task.wait(0.05)
			if not frame or not frame.Parent then break end
			frame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
		end
		if callback then callback() end
	end)
end

-- â”€â”€ TYPEWRITER CON PULSO DE CORAZÃ“N POR LETRA â”€â”€
local function heartbeatTypewriter(label, text, heartIcon, onDone)
	label.Text = ""
	task.spawn(function()
		for i = 1, #text do
			if not label or not label.Parent then return end
			label.Text = text:sub(1, i)

			-- FIX: pulsar el Ã­cono â¤ con Size del contenedor Y TextSize del emoji
			if heartIcon and heartIcon.Parent then
				playHeartbeat()
				-- Latido: agrandar TextSize del emoji
				TweenService:Create(heartIcon, TweenInfo.new(0.07, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
					TextSize   = 52,
					TextColor3 = Color3.fromRGB(255, 0, 0)
				}):Play()
				task.wait(0.09)
				TweenService:Create(heartIcon, TweenInfo.new(0.11, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
					TextSize   = 34,
					TextColor3 = Color3.fromRGB(180, 0, 0)
				}):Play()
			end

			task.wait(0.13)
		end
		if onDone then onDone() end
	end)
end

-- ================================================
-- PANTALLA SCREAMER DE TIMEOUT
-- "TIEMPO TERMINADO â€” EstÃ¡s baneado por Explotar el juego"
-- Se muestra ANTES de enviar el ban al servidor
-- ================================================
local function showTimeoutScreamer(gui, onDone)
	-- Destruir contenido previo sin destruir el ScreenGui
	local old = gui:FindFirstChild("TimeoutScreamer")
	if old then old:Destroy() end

	playScreamer()

	-- Frame negro que cubre TODA la pantalla
	local scream = Instance.new("Frame")
	scream.Name             = "TimeoutScreamer"
	scream.Size             = UDim2.new(1, 0, 1, 0)
	scream.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	scream.BorderSizePixel  = 0
	scream.ZIndex           = 10
	scream.Parent           = gui

	-- Flash rojo ultra rÃ¡pido (el "susto")
	task.spawn(function()
		for _ = 1, 30 do
			task.wait(0.03)
			if not scream or not scream.Parent then break end
			scream.BackgroundColor3 = Color3.fromRGB(
				math.random(150, 255),
				math.random(0, 10),
				math.random(0, 10)
			)
		end
		if scream and scream.Parent then
			scream.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		end
	end)

	-- Texto "TIEMPO TERMINADO" enorme
	local timeUp = Instance.new("TextLabel")
	timeUp.Size                   = UDim2.new(0.9, 0, 0, 120)
	timeUp.Position               = UDim2.new(0.05, 0, 0.1, 0)
	timeUp.AnchorPoint            = Vector2.new(0, 0)
	timeUp.BackgroundTransparency = 1
	timeUp.Text                   = "â± TIEMPO TERMINADO"
	timeUp.Font                   = Enum.Font.GothamBold
	timeUp.TextSize               = 62
	timeUp.TextColor3             = Color3.fromRGB(255, 50, 0)
	timeUp.TextTransparency       = 1
	timeUp.TextWrapped            = true
	timeUp.ZIndex                 = 11
	timeUp.Parent                 = scream

	-- Ãcono de calavera enorme
	local bigSkull = Instance.new("TextLabel")
	bigSkull.Size                   = UDim2.new(0, 200, 0, 200)
	bigSkull.Position               = UDim2.new(0.5, -100, 0.25, 0)
	bigSkull.BackgroundTransparency = 1
	bigSkull.Text                   = "ðŸ’€"
	bigSkull.Font                   = Enum.Font.GothamBold
	bigSkull.TextSize               = 140
	bigSkull.TextTransparency       = 1
	bigSkull.ZIndex                 = 11
	bigSkull.Parent                 = scream

	-- Texto principal de baneo
	local banMsg = Instance.new("TextLabel")
	banMsg.Size                   = UDim2.new(0.85, 0, 0, 100)
	banMsg.Position               = UDim2.new(0.075, 0, 0.58, 0)
	banMsg.BackgroundTransparency = 1
	banMsg.Text                   = "EstÃ¡s baneado por\nExplotar el juego"
	banMsg.Font                   = Enum.Font.GothamBold
	banMsg.TextSize               = 48
	banMsg.TextColor3             = Color3.fromRGB(255, 255, 255)
	banMsg.TextTransparency       = 1
	banMsg.TextWrapped            = true
	banMsg.ZIndex                 = 11
	banMsg.Parent                 = scream

	-- LÃ­nea de detalle
	local detail = Instance.new("TextLabel")
	detail.Size                   = UDim2.new(0.8, 0, 0, 40)
	detail.Position               = UDim2.new(0.1, 0, 0.82, 0)
	detail.BackgroundTransparency = 1
	detail.Text                   = "No respondiste a tiempo. Ban permanente."
	detail.Font                   = Enum.Font.Gotham
	detail.TextSize               = 20
	detail.TextColor3             = Color3.fromRGB(200, 200, 200)
	detail.TextTransparency       = 1
	detail.ZIndex                 = 11
	detail.Parent                 = scream

	-- AnimaciÃ³n de entrada del screamer
	task.spawn(function()
		task.wait(0.3)

		-- Aparecer "TIEMPO TERMINADO" de golpe
		TweenService:Create(timeUp, TweenInfo.new(0.15), {TextTransparency = 0}):Play()
		task.wait(0.3)

		-- Calavera con bounce
		TweenService:Create(bigSkull, TweenInfo.new(0.5, Enum.EasingStyle.Bounce), {TextTransparency = 0}):Play()
		task.wait(0.7)

		-- Mensaje de ban letra a letra (sin pulso, aquÃ­ es mÃ¡s impacto)
		banMsg.Text = ""
		local fullText = "EstÃ¡s baneado por\nExplotar el juego"
		for i = 1, #fullText do
			task.wait(0.04)
			if not banMsg or not banMsg.Parent then return end
			banMsg.Text = fullText:sub(1, i)
			if banMsg.TextTransparency > 0 then
				banMsg.TextTransparency = 0
			end
		end

		task.wait(0.4)
		fadeIn(detail, "TextTransparency", 0.5)

		-- Pulso rojo de calavera
		task.spawn(function()
			while bigSkull and bigSkull.Parent do
				TweenService:Create(bigSkull, TweenInfo.new(0.3), {TextSize = 155}):Play()
				task.wait(0.3)
				TweenService:Create(bigSkull, TweenInfo.new(0.3), {TextSize = 140}):Play()
				task.wait(0.3)
			end
		end)

		-- Esperar 3 segundos y luego llamar onDone (que envÃ­a el ban)
		task.wait(3)
		if onDone then onDone() end
	end)
end

-- ================================================
-- CONTADOR DE 20 SEGUNDOS
-- FIX: latidos rÃ¡pidos + screamer al llegar a 0
-- ================================================
local function startCountdown(bg, gui, onTimeout)
	-- Caja del contador
	local box = Instance.new("Frame")
	box.Size                   = UDim2.new(0.7, 0, 0, 90)
	-- FIX: AnchorPoint para centrar correctamente en cualquier resoluciÃ³n
	box.AnchorPoint            = Vector2.new(0.5, 0)
	box.Position               = UDim2.new(0.5, 0, 0.83, 0)
	box.BackgroundColor3       = Color3.fromRGB(0, 0, 0)
	box.BackgroundTransparency = 0.1
	box.BorderSizePixel        = 0
	box.Parent                 = bg
	Instance.new("UICorner", box).CornerRadius = UDim.new(0, 16)

	local warn = Instance.new("TextLabel")
	warn.Size                   = UDim2.new(1, -16, 0.44, 0)
	warn.Position               = UDim2.new(0, 8, 0, 0)
	warn.BackgroundTransparency = 1
	warn.Text                   = "âš   Di una respuesta antes que el tiempo se acabe"
	warn.Font                   = Enum.Font.GothamBold
	warn.TextSize               = 14
	warn.TextColor3             = Color3.fromRGB(255, 210, 0)
	warn.TextWrapped            = true
	warn.TextXAlignment         = Enum.TextXAlignment.Center
	warn.Parent                 = box

	local countLabel = Instance.new("TextLabel")
	countLabel.Size                   = UDim2.new(1, -16, 0.56, 0)
	countLabel.Position               = UDim2.new(0, 8, 0.44, 0)
	countLabel.BackgroundTransparency = 1
	countLabel.Text                   = "Â¡o te vas para siempre del juego!   20"
	countLabel.Font                   = Enum.Font.GothamBold
	countLabel.TextSize               = 16
	countLabel.TextColor3             = Color3.fromRGB(0, 255, 0)
	countLabel.TextWrapped            = true
	countLabel.TextXAlignment         = Enum.TextXAlignment.Center
	countLabel.Parent                 = box

	-- Countdown loop
	task.spawn(function()
		for i = 20, 0, -1 do
			if not countLabel or not countLabel.Parent then return end

			-- Color: verde â†’ amarillo â†’ naranja â†’ rojo
			local t   = i / 20
			local r   = math.min(255, math.floor(255 * (2 - 2 * t)))
			local g   = math.min(255, math.floor(255 * (2 * t)))
			countLabel.TextColor3 = Color3.fromRGB(r, g, 0)

			if i > 0 then
				countLabel.Text = "Â¡o te vas para siempre del juego!   " .. i

				-- FIX: sonido de latido urgente cada segundo del contador
				playUrgentBeat()

				-- Pulso visual en los Ãºltimos 8 segundos
				if i <= 8 then
					TweenService:Create(countLabel, TweenInfo.new(0.15), {TextSize = 21}):Play()
					task.wait(0.15)
					if not countLabel or not countLabel.Parent then return end
					TweenService:Create(countLabel, TweenInfo.new(0.15), {TextSize = 16}):Play()
					task.wait(0.85)
				else
					task.wait(1)
				end
			else
				-- i == 0: tiempo agotado
				countLabel.Text = "Â¡o te vas para siempre del juego!   ðŸ’€"

				-- FIX: destruir el box del contador
				if box and box.Parent then box:Destroy() end

				-- FIX: mostrar screamer ANTES de enviar el ban
				showTimeoutScreamer(gui, function()
					onTimeout()
				end)
				return
			end
		end
	end)

	return box
end

-- ================================================
-- PANTALLA 1 â€” "ERES UN TRAMPOSO" (primera vez)
-- ================================================
local function showFirstScreen(reason)
	playScarySound()
	playCreepyVoice()

	local gui = makeGui()

	-- FONDO BLANCO
	local bg = Instance.new("Frame")
	bg.Size                = UDim2.new(1, 0, 1, 0)
	bg.BackgroundColor3    = Color3.fromRGB(255, 255, 255)
	bg.BorderSizePixel     = 0
	bg.Parent              = gui

	-- LÃ­neas rojas de fondo
	for i = 1, 10 do
		local line = Instance.new("Frame")
		line.Size                   = UDim2.new(1, 0, 0, 2)
		line.Position               = UDim2.new(0, 0, i * 0.09, 0)
		line.BackgroundColor3       = Color3.fromRGB(200, 0, 0)
		line.BackgroundTransparency = 0.5
		line.BorderSizePixel        = 0
		line.Parent                 = bg
	end

	-- CorazÃ³n pulsante (pulsa con cada letra)
	local heartIcon = Instance.new("TextLabel")
	heartIcon.Size                   = UDim2.new(0, 50, 0, 50)
	heartIcon.AnchorPoint            = Vector2.new(0.5, 0)
	heartIcon.Position               = UDim2.new(0.5, 0, 0.01, 0)
	heartIcon.BackgroundTransparency = 1
	heartIcon.Text                   = "â¤"
	heartIcon.Font                   = Enum.Font.GothamBold
	heartIcon.TextSize               = 34
	heartIcon.TextColor3             = Color3.fromRGB(180, 0, 0)
	heartIcon.Parent                 = bg

	-- Latido de fondo constante
	task.spawn(function()
		while heartIcon and heartIcon.Parent do
			TweenService:Create(heartIcon, TweenInfo.new(0.15), {TextSize = 44}):Play()
			task.wait(0.15)
			TweenService:Create(heartIcon, TweenInfo.new(0.2),  {TextSize = 34}):Play()
			task.wait(0.65)
		end
	end)

	-- Calavera
	local skull = Instance.new("TextLabel")
	skull.Size                   = UDim2.new(0, 160, 0, 160)
	skull.AnchorPoint            = Vector2.new(0.5, 0)
	skull.Position               = UDim2.new(0.5, 0, 0.07, 0)
	skull.BackgroundTransparency = 1
	skull.Text                   = "â˜ "
	skull.Font                   = Enum.Font.GothamBold
	skull.TextSize               = 110
	skull.TextColor3             = Color3.fromRGB(0, 0, 0)
	skull.Parent                 = bg

	task.spawn(function()
		while skull and skull.Parent do
			TweenService:Create(skull, TweenInfo.new(0.35), {TextColor3 = Color3.fromRGB(180, 0, 0)}):Play()
			task.wait(0.35)
			TweenService:Create(skull, TweenInfo.new(0.35), {TextColor3 = Color3.fromRGB(0, 0, 0)}):Play()
			task.wait(0.35)
		end
	end)

	-- TÃ­tulo
	local title = Instance.new("TextLabel")
	title.Size                   = UDim2.new(0.9, 0, 0, 80)
	title.AnchorPoint            = Vector2.new(0.5, 0)
	title.Position               = UDim2.new(0.5, 0, 0.29, 0)
	title.BackgroundTransparency = 1
	title.Text                   = ""
	title.Font                   = Enum.Font.GothamBold
	title.TextSize               = 52
	title.TextColor3             = Color3.fromRGB(0, 0, 0)
	title.TextWrapped            = true
	title.TextXAlignment         = Enum.TextXAlignment.Center
	title.Parent                 = bg

	-- RazÃ³n detectada
	local sub = Instance.new("TextLabel")
	sub.Size                   = UDim2.new(0.8, 0, 0, 36)
	sub.AnchorPoint            = Vector2.new(0.5, 0)
	sub.Position               = UDim2.new(0.5, 0, 0.44, 0)
	sub.BackgroundTransparency = 1
	sub.Text                   = ""
	sub.Font                   = Enum.Font.Gotham
	sub.TextSize               = 19
	sub.TextColor3             = Color3.fromRGB(180, 0, 0)
	sub.TextWrapped            = true
	sub.TextXAlignment         = Enum.TextXAlignment.Center
	sub.Parent                 = bg

	-- Pregunta (letra a letra con pulso de corazÃ³n)
	local question = Instance.new("TextLabel")
	question.Size                   = UDim2.new(0.85, 0, 0, 52)
	question.AnchorPoint            = Vector2.new(0.5, 0)
	question.Position               = UDim2.new(0.5, 0, 0.53, 0)
	question.BackgroundTransparency = 1
	question.Text                   = ""
	question.Font                   = Enum.Font.GothamBold
	question.TextSize               = 26
	question.TextColor3             = Color3.fromRGB(0, 0, 0)
	question.TextWrapped            = true
	question.TextXAlignment         = Enum.TextXAlignment.Center
	question.Parent                 = bg

	-- FIX: botones centrados con AnchorPoint para cualquier resoluciÃ³n
	-- BotÃ³n incorrecto (izquierda del centro)
	local btnSi = Instance.new("TextButton")
	btnSi.Size                   = UDim2.new(0, 245, 0, 62)
	btnSi.AnchorPoint            = Vector2.new(1, 0)
	btnSi.Position               = UDim2.new(0.5, -8, 0.67, 0)
	btnSi.BackgroundColor3       = Color3.fromRGB(180, 0, 0)
	btnSi.Text                   = "ðŸ˜ˆ  SÃ­ seguirÃ© usando Exploit"
	btnSi.Font                   = Enum.Font.GothamBold
	btnSi.TextSize               = 15
	btnSi.TextColor3             = Color3.fromRGB(255, 255, 255)
	btnSi.BorderSizePixel        = 0
	btnSi.BackgroundTransparency = 1
	btnSi.Parent                 = bg
	Instance.new("UICorner", btnSi).CornerRadius = UDim.new(0, 12)

	-- BotÃ³n correcto (derecha del centro)
	local btnNo = Instance.new("TextButton")
	btnNo.Size                   = UDim2.new(0, 280, 0, 62)
	btnNo.AnchorPoint            = Vector2.new(0, 0)
	btnNo.Position               = UDim2.new(0.5, 8, 0.67, 0)
	btnNo.BackgroundColor3       = Color3.fromRGB(0, 120, 0)
	btnNo.Text                   = "ðŸ™  Lo siento mucho, no lo harÃ©.\nDejarÃ© el script"
	btnNo.Font                   = Enum.Font.GothamBold
	btnNo.TextSize               = 14
	btnNo.TextColor3             = Color3.fromRGB(255, 255, 255)
	btnNo.BorderSizePixel        = 0
	btnNo.BackgroundTransparency = 1
	btnNo.Parent                 = bg
	Instance.new("UICorner", btnNo).CornerRadius = UDim.new(0, 12)

	-- Advertencia
	local warning = Instance.new("TextLabel")
	warning.Size                   = UDim2.new(0.9, 0, 0, 26)
	warning.AnchorPoint            = Vector2.new(0.5, 0)
	warning.Position               = UDim2.new(0.5, 0, 0.78, 0)
	warning.BackgroundTransparency = 1
	warning.Text                   = "âš  Mentir tiene consecuencias..."
	warning.Font                   = Enum.Font.Gotham
	warning.TextSize               = 13
	warning.TextColor3             = Color3.fromRGB(100, 100, 100)
	warning.TextTransparency       = 1
	warning.TextXAlignment         = Enum.TextXAlignment.Center
	warning.Parent                 = bg

	local clicked  = false
	local countBox = nil

	local function onClickSi()
		if clicked then return end
		clicked = true
		if countBox and countBox.Parent then countBox:Destroy() end
		btnSi.Active = false
		btnNo.Active = false
		exploitResponse:FireServer("si")
		task.wait(0.3)
		if gui and gui.Parent then gui:Destroy() end
	end

	local function onClickNo()
		if clicked then return end
		clicked = true
		if countBox and countBox.Parent then countBox:Destroy() end
		btnSi.Active = false
		btnNo.Active = false
		exploitResponse:FireServer("no")
		TweenService:Create(bg, TweenInfo.new(0.8), {BackgroundTransparency = 1}):Play()
		for _, v in ipairs(bg:GetDescendants()) do
			if v:IsA("TextLabel") or v:IsA("TextButton") then
				TweenService:Create(v, TweenInfo.new(0.8), {
					TextTransparency = 1, BackgroundTransparency = 1
				}):Play()
			end
		end
		task.wait(1)
		if gui and gui.Parent then gui:Destroy() end
	end

	btnSi.MouseButton1Click:Connect(onClickSi)
	btnNo.MouseButton1Click:Connect(onClickNo)

	-- ANIMACIÃ“N DE ENTRADA
	flickerDark(bg, 5, function()
		task.wait(0.2)
		task.spawn(function() glitchText(title, "ERES UN TRAMPOSO", 1.1) end)
		task.wait(0.5)
		task.spawn(function() glitchText(sub, "Detectado: "..tostring(reason), 0.6) end)
		task.wait(0.8)

		heartbeatTypewriter(question, "Â¿SeguirÃ¡s usando exploit?", heartIcon, function()
			task.wait(0.3)
			TweenService:Create(btnSi, TweenInfo.new(0.4), {BackgroundTransparency = 0}):Play()
			task.wait(0.15)
			Twee
